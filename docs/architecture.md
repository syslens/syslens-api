# SysLens 系统架构

## 总体架构

SysLens是一个分布式服务器监控系统，由两个主要组件构成：

1. **主控端(Control Plane)**：中央管理服务器，负责接收、存储、分析和展示来自所有节点的监控数据
2. **节点端(Node Agent)**：部署在每台被监控服务器上的代理程序，负责收集本地系统指标并上报至主控端

系统采用简单高效的C/S架构，节点端定期采集数据并主动上报，主控端接收并处理这些数据。

## 数据流

```bash
+-------------+           +---------------+           +--------------+
|             |  采集     |               |  上报     |              |
| 服务器资源  | --------> |   节点代理    | --------> |    主控端    |
| (CPU/内存等)|           | (Agent)       |           | (Server)     |
+-------------+           +---------------+           +--------------+
                                                            |
                                                            | 存储
                                                            v
                                                      +--------------+
                                                      |              |
                                                      |   数据存储   |
                                                      |              |
                                                      +--------------+
                                                            |
                                                            | 检索
                                                            v
                                                      +--------------+
                                                      |              |
                                                      | 告警/可视化  |
                                                      |              |
                                                      +--------------+
```

## 节点端(Agent)架构

节点端采用模块化设计，主要包含以下组件：

1. **采集器(Collector)**：负责采集系统各项指标，支持CPU、内存、磁盘、网络等资源的监控
2. **上报器(Reporter)**：负责将采集的指标数据上报到主控端
3. **配置管理**：管理节点端的各项配置，支持从文件加载配置

节点端工作流程：

1. 启动时加载配置
2. 初始化采集器和上报器
3. 按配置的采集间隔定期采集系统指标
4. 将采集到的指标数据上报到主控端
5. 记录日志并处理异常情况

## 主控端(Server)架构

主控端采用分层架构设计，包含以下主要组件：

1. **API层**：提供HTTP/gRPC接口，处理节点上报数据和查询请求
2. **服务层**：实现核心业务逻辑，包括节点管理、数据处理等
3. **存储层**：管理监控数据的存储和检索，支持多种存储后端
4. **告警系统**：基于规则检测异常并触发告警
5. **可视化接口**：为前端仪表盘提供数据支持

主控端工作流程：

1. 启动时加载配置
2. 初始化存储系统和API服务
3. 接收节点上报的指标数据并存储
4. 定期检查指标数据，触发告警（如配置）
5. 响应API查询请求，提供数据给前端或其他系统

## 存储设计

系统支持多种存储后端：

1. **内存存储**：适用于开发测试或小规模部署，数据存储在内存中
2. **文件存储**：将数据保存到本地文件系统，支持数据滚动
3. **时序数据库**：对于生产环境，推荐使用InfluxDB等时序数据库，更适合存储和查询时间序列数据

## 扩展性考虑

1. **水平扩展**：主控端可部署多实例，通过负载均衡分担节点上报请求
2. **多级部署**：大型环境下可采用分层部署，设置区域代理服务器
3. **插件机制**：支持通过插件扩展采集器和告警通知渠道

## 安全性考虑

1. **认证**：节点和主控端之间的通信支持令牌认证
2. **传输加密**：支持TLS加密传输
3. **数据校验**：对上报数据进行签名校验，防止伪造

## 技术栈

- **语言**：Go语言
- **通信**：HTTP/JSON (可扩展支持gRPC)
- **配置**：YAML格式
- **存储**：支持内存、文件系统和外部数据库
